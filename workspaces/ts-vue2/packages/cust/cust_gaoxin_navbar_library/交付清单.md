# cust_gaoxin_navbar_library 交付清单（高信导航栏二开）

## 背景与目标

- **项目背景**：高信项目在 PC 端需要对“导航栏（多级）”进行二次开发，满足更灵活的业务导航样式与交互诉求。
- **二开目标**：基于平台基础导航栏（`UNavbarMulti`）进行增强，新增“基于数据源的节点自定义渲染能力”，使导航栏各级节点（导航栏顶层 / 非叶子节点 / 叶子节点）可通过插槽实现样式与内容的完全定制。

## 组件说明

本次交付仅包含高信二开组件：

- **交付组件**：`src/components/gx-u-navbar-multi`
- **定位**：在 `UNavbarMulti` 基础能力上扩展“数据源节点插槽渲染”，用于满足高信项目对导航栏节点样式/内容的定制化需求。

## 目录与文件总览（交付范围）

### `src/components/gx-u-navbar-multi`

- **新增运行时组件**
  - `dynamic-group.vue`：用于“非叶子节点”的动态渲染（并在顶层导航栏处承担“导航栏节点插槽”渲染）
  - `dynamic-item.vue`：用于“叶子节点”的动态渲染（并在顶层导航栏处承担“导航栏节点插槽”渲染）
- **新增示例**
  - `demos/ExamplesDemo.vue`：演示三级目录数据源 + 三类插槽渲染（navbar / nonLeaf / leaf）及开关切换

## 关键差异详解（按文件）

### 1) `api.ts`：NASL 组件 API 差异

#### `gx-u-navbar-multi/api.ts`（二开版新增/调整）

- **组件形态**
  - 不直接替换原 `UNavbarMulti`，以独立组件形态交付并在平台侧选择使用。
- **新增开关：动态选项插槽**
  - 新增 `optionIsSlot: Boolean`（仅在 `hasDataSource = true` 时出现）
  - 用途：开启后启用“动态节点渲染”路径，使数据源渲染由 `dynamic-group/item` 承担，并允许外部通过插槽定制节点内容。
- **新增 3 个“节点渲染插槽”（核心能力）**
  - `slotNavbarNode(current: { item: T; index: Integer })`
  - `slotNonLeafNode(current: { item: T; index: Integer })`
  - `slotLeafNode(current: { item: T; index: Integer })`
  - 设计意图：将“顶层导航栏节点/下拉里的非叶子节点/下拉里的叶子节点”分开定制，从而实现各级节点样式完全可控。

### 2) `index.vue`：运行时渲染逻辑差异

#### `gx-u-navbar-multi/index.vue`（二开版核心改动）

- **新增分支：`optionIsSlot`**
  - `optionIsSlot = true`：
    - 非叶子节点渲染为 `u-navbar-dynamic-group`
    - 叶子节点渲染为 `u-navbar-dynamic-item`
    - 并把外部插槽透传为三类插槽：
      - `navbarNode`
      - `nonLeafNode`
      - `leafNode`
  - `optionIsSlot = false`：
    - 回退到默认渲染（`u-navbar-group-multi` / `u-navbar-item-multi`），保证兼容与快速切换。
- **设计器体验增强（重要）**
  - 增加 `mockDataSource`：当 `$env.VUE_APP_DESIGNER && optionIsSlot` 时，提供最小树形数据，避免设计器画布因为无数据导致无法编辑插槽/节点。

### 3) `dynamic-group.vue` / `dynamic-item.vue`：新增动态节点组件

#### `dynamic-group.vue`

- 继承自 `group.vue`（`extends: UNavbarGroupMulti`），复用基础交互与弹层逻辑。
- 在不同层级渲染时，使用不同插槽名：
  - 顶层导航栏（`isInNavbar`）：使用 `navbarNode`
  - 下拉面板里的非叶子节点：使用 `nonLeafNode`
- 递归渲染子节点时：
  - 子非叶节点继续走 `u-navbar-dynamic-group`（仅透传 `nonLeafNode/leafNode`）
  - 子叶子节点走 `u-navbar-dynamic-item`（仅透传 `leafNode`）

#### `dynamic-item.vue`

- 继承自 `item.vue`（`extends: UNavbarItemMulti`），复用基础路由/链接/选中逻辑。
- 在不同层级渲染时，使用不同插槽名：
  - 顶层导航栏（`isInNavbar`）：使用 `navbarNode`
  - 下拉面板叶子节点：使用 `leafNode`
- 透出 `node` 与 `index`，供外部插槽自由渲染。

### 4) 入口导出差异（`index.js` / `src/components/index.ts`）

- `src/components/index.ts` 导出 `GxUNavbarMulti` 及其相关子组件，供平台侧直接使用。
- `gx-u-navbar-multi/index.js` 中 **dynamic 组件未对外导出**（注释状态），说明它们是实现细节，外部只通过 `gx-u-navbar-multi` 的插槽能力使用即可。

## 二开新增能力清单（面向交付/验收）

- **数据源模式下的节点渲染可定制**
  - 通过 `optionIsSlot` 开启
  - 通过 `navbarNode / nonLeafNode / leafNode` 三类插槽分别定制不同层级节点
- **设计器可编辑性增强**
  - 设计器环境下为插槽模式注入 `mockDataSource`，保障插槽可视化编辑与预览
- **保持原能力可回退**
  - `optionIsSlot=false` 时仍走默认渲染逻辑（`u-navbar-group-multi` / `u-navbar-item-multi`），降低二开风险
- **示例补齐**
  - `demos/ExamplesDemo.vue` 给出三级目录数据源 + 三类插槽渲染的参考写法
